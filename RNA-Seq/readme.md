# RNA-Seq Alignment and Expression Analysis Pipeline

This directory contains a complete bioinformatics pipeline for processing raw RNA-Seq data (FASTQ) into normalized expression values and gene rankings. The workflow is optimized for the mouse reference genome (**GRCm38/mm10**) and focuses on the comparison between **B6N4** and **BFMI4** strains.

##  Contents

* `pipeline.sh`: Bash script for reference preparation, alignment (STAR), and post-processing (Picard/GATK).
* `analysis.r`: R script for read counting, RPKM calculation, quantile normalization, and Ensembl annotation.
* `gene-ranks.csv`: A ranked list of genes based on the fold change between BFMI4 and B6N4 (log2PKFM).

---

##  Workflow Overview

### 1. Pre-processing & Alignment (`pipeline.sh`)
The shell script handles the heavy-duty processing from raw reads to high-quality BAM files.

* **Reference Setup:** Automatically downloads GRCm38 (Ensembl 102) and prepares indexes for STAR and GATK.
* **Alignment:** Maps paired-end reads using the **STAR** aligner.
* **Deduplication:** Identifies and removes PCR duplicates using **Picard Tools**.
* **BQSR (Base Quality Score Recalibration):** Uses **GATK** and dbSNP142 to correct systematic errors in base quality scores.
* **Output:** Generates coordinate-sorted, recalibrated `.bam` files ready for quantification.

### 2. Statistical Analysis (`analysis.r`)
The R script processes the BAM files to generate biological insights.

* **Quantification:** Counts reads per gene using `summarizeOverlaps` (Union mode).
* **Normalization:** * Calculates **RPKM** to account for gene length and library size.
    * Applies **Quantile Normalization** to ensure identical distributions across samples.
    * Performs **Log2 transformation** (with a 0.1 offset).
* **Annotation:** Merges Ensembl Gene IDs with official gene names and descriptions using the **biomaRt** Nov 2020 archive.

---

##  Requirements

### External Software
Ensure the following tools are installed and accessible in your `$PATH` or configured within the script:
* **STAR** (v2.7+)
* **Picard Tools** (`picard.jar`)
* **GATK4** (`gatk-package-4.2.6.1-local.jar` or similar)
* **Samtools**

### R Environment
The following **Bioconductor** packages are required:
`GenomicAlignments`, `GenomicFeatures`, `Rsamtools`, `preprocessCore`, `BiocParallel`, `biomaRt`

---

##  Usage

1.  **Configuration:** Edit the `USER CONFIGURATION` section in both `pipeline.sh` and `analysis.r` to match your local directory structure (e.g., `WORKDIR`, `FASTQ_DIR`).
    
2.  **Execute Alignment:**
    ```bash
    bash pipeline.sh
    ```

3.  **Execute Analysis:**
    ```bash
    Rscript analysis.r
    ```

---

##  Output Files

The following files are generated by the analysis:
* `Raw_Reads_Per_Gene.txt`: Tab-separated raw count matrix.
* `RPKM_Log2_Matrix.txt`: Normalized and log-transformed expression values.
* `Final_Results_Overview.txt`: The comprehensive results table including gene names and descriptions.
* `gene-ranks.csv`: A prioritized list of genes sorted by fold change.

---

## ⚖️ License & Attribution

### Scripts
The code in this repository is licensed under the **GNU General Public License v3.0 (GPL-3.0)**.
* **Original Author:** Danny Arends
* **Modified by:** Florian Krause (2021-2025)

### Dependencies & Data
* **Tools:** STAR (MIT), Picard (Apache 2.0), GATK (BSD-3-Clause).
* **Reference Data:** Mouse GRCm38.p6 from Ensembl (CC-BY 4.0).
    * *Citation: Ensembl release 102 | Mus musculus GRCm38.*